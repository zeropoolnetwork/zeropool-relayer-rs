#!/usr/bin/env bash


USERNAME=voidxnull
IMAGE=zeropool-relayer

VERSION=$(cargo metadata --format-version 1 | jq -r ".packages[] | select(.name==\"zeropool-relayer\") | .version")
LATEST_IMAGE=$USERNAME/$IMAGE:latest
VERSIONED_IMAGE=$USERNAME/$IMAGE:$VERSION

echo "Publishing $LATEST_IMAGE and $VERSIONED_IMAGE"

docker build -f ./docker/Dockerfile -t "$LATEST_IMAGE" . && \
docker tag "$LATEST_IMAGE" "$VERSIONED_IMAGE" && \
docker push "$LATEST_IMAGE" && \
docker push "$VERSIONED_IMAGE"